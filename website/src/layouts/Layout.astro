---
import '../styles/global.css';
import { ui, defaultLocale, type Locale } from '../i18n/ui';

interface Props {
  title: string;
  description: string;
  lang: string;
  locale: Locale;
  canonicalURL?: URL;
}

const { title, description, lang, locale, canonicalURL } = Astro.props;
const t = (key: keyof typeof ui.en) => (ui[locale] ?? ui[defaultLocale])[key] ?? key;
const otherLocale: Locale = locale === 'en' ? 'ja' : 'en';
const otherUrl = locale === 'en' ? '/ja/' : '/';
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    {canonicalURL && <link rel="canonical" href={canonicalURL.toString()} />}
    <!-- OGP -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL?.toString() ?? Astro.url.href} />
    <meta property="og:image" content={new URL('/og-image.png', Astro.url).toString()} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href={locale === 'en' ? '/' : '/ja/'} class="logo">
          <img src="/bokuchi-icon.png" alt="" class="logo-icon" width="24" height="24" />
          Bokuchi
        </a>
        <nav>
          <ul class="nav-links">
            <li><a href={locale === 'en' ? '/#why' : '/ja/#why'}>{t('nav.why')}</a></li>
            <li><a href={locale === 'en' ? '/#features' : '/ja/#features'}>{t('nav.features')}</a></li>
            <li><a href={locale === 'en' ? '/#themes' : '/ja/#themes'}>{t('nav.themes')}</a></li>
            <li><a href={locale === 'en' ? '/#languages' : '/ja/#languages'}>{t('nav.languages')}</a></li>
            <li><a href={locale === 'en' ? '/#download' : '/ja/#download'}>{t('nav.download')}</a></li>
            <li><a href="https://github.com/Bokuchi-Editor/bokuchi" target="_blank" rel="noopener noreferrer">{t('nav.github')}</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="site-footer">
      <div class="container">
        <ul class="footer-links">
          <li><a href="https://github.com/Bokuchi-Editor/bokuchi" target="_blank" rel="noopener noreferrer">GitHub</a></li>
          <li><a href="https://github.com/Bokuchi-Editor/bokuchi/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">{t('footer.license')}</a></li>
        </ul>
        <span class="lang-switch">
          {t('footer.lang')}: <a href={otherUrl}>{otherLocale === 'en' ? 'English' : '日本語'}</a>
        </span>
      </div>
    </footer>

    <!-- Lightbox: click/tap image to enlarge -->
    <div class="lightbox-overlay" id="lightbox" role="dialog" aria-modal="true" aria-label="Expand image" hidden>
      <button type="button" class="lightbox-close" aria-label="Close">×</button>
      <img class="lightbox-img" src="" alt="" />
    </div>

    <script>
      (function () {
        const overlay = document.getElementById('lightbox');
        const img = overlay?.querySelector('.lightbox-img');
        const closeBtn = overlay?.querySelector('.lightbox-close');
        if (!overlay || !img) return;

        const selector = '.hero .screenshot img, .feature-row .screenshot img, .theme-item img';
        const open = (src, alt) => {
          img.src = src;
          img.alt = alt || '';
          overlay.hidden = false;
          overlay.classList.add('lightbox-open');
          document.body.style.overflow = 'hidden';
        };
        const close = () => {
          overlay.hidden = true;
          overlay.classList.remove('lightbox-open');
          document.body.style.overflow = '';
        };

        document.querySelectorAll(selector).forEach((el) => {
          el.addEventListener('click', (e) => {
            e.preventDefault();
            const target = e.currentTarget;
            if (target.currentSrc) open(target.currentSrc, target.alt);
          });
          el.style.cursor = 'pointer';
        });

        overlay.addEventListener('click', (e) => { if (e.target === overlay) close(); });
        closeBtn?.addEventListener('click', close);
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
      })();
    </script>
  </body>
</html>
